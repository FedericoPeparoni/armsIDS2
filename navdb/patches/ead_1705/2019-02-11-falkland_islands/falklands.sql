--insert CTR MONTE AGRADABLE WITH NO GEOMETRY

insert into navdb.airspace values((select max(airspace_pk) + 1 from navdb.airspace), '2015-05-28 00:00:00', '2015-10-27 16:28:41.194209', 'aixmimporter', 'aixmimporter', NULL, (select max(airspace_pk) + 1 from navdb.airspace), NULL, 'A', 'CTR', 'CTRAGRA', NULL, NULL, 'MONTE AGRADABLE', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, '2015-05-28 00:00:00', 'infinity');

--SET CTR MONTE AGRADABLE WITH GEOMETRY
update navdb.airspace set geom = ST_GeomFromText('MULTIPOLYGON(((-62.481541969811467 -52.02906235479422, -62.4768562072151 -52.067490261036546, -62.456153490082549 -52.217526093932932, -62.413185368557222 -52.361693838172506, -62.360313699630218 -52.500591771975508, -62.296716140058592 -52.6470486784646, -62.216399123059709 -52.781279988040943, -62.12317132654163 -52.916558016114557, -62.044503534705896 -53.010699956972125, -62.007810529561283 -53.047287864420625, -61.920415857549827 -53.141127309927263, -58.392674736218083 -53.078184100458898, -58.337540361386026 -53.07735153773389, -58.094444000261326 -53.064646563009617, -57.856544004633001 -53.034384790833883, -57.622915358126299 -52.983540285864947, -57.408378122435508 -52.918947461574241, -57.203190919677233 -52.840595544236308, -57.01480328245551 -52.743993138872817, -56.854599415647186 -52.639871448328286, -56.702832367376679 -52.519087754821101, -56.588012586164211 -52.391500023292515, -56.495353362190301 -52.256730333258126, -56.429343905478618 -52.116128305534041, -56.399701608706501 -52.000348879729785, -56.391552837547032 -51.968850917087671, -56.381132683064699 -51.818370569991387, -56.40093655901174 -51.669897819069547, -56.446136775645179 -51.526609077535781, -56.517660969049096 -51.386561152158002, -56.612604818054976 -51.251531825355087, -56.733454294670942 -51.124648141080087, -56.885073512679867 -51.009168514586513, -57.049199827125854 -50.904827073332577, -57.233043468205814 -50.806034429145093, -57.424074158108596 -50.727434465383617, -57.636615723601317 -50.663850805020878, -57.85293561369275 -50.613643715985631, -58.088211341483877 -50.581638183700555, -58.314569303978381 -50.566702153077131, -58.491369302717665 -50.563725556602407, -61.90113057766181 -50.567550070763275, -61.974508355305474 -50.643765540345143, -62.072695714230321 -50.779543953388171, -62.175018781996926 -50.907339903802104, -62.267155802494045 -51.05665293171964, -62.329253039243575 -51.192856945762948, -62.391735577806969 -51.341102828745285, -62.434396263951065 -51.478715378604832, -62.467805783424488 -51.62715378247082, -62.48082714915278 -51.771078998885088, -62.481541969811467 -52.02906235479422)))', 4326) where airspace_pk = (select max(airspace_pk) from navdb.airspace);
 
-- SAVF_X0: bogus FIR_P that is a copy of SAVF, but with Falklands CTR cut out
insert into navdb.airspace values((select max(airspace_pk) + 1 from navdb.airspace), '2015-05-28 00:00:00', '2015-10-27 16:28:41.194209', 'aixmimporter', 'aixmimporter', NULL, (select max(airspace_pk) + 1 from navdb.airspace), NULL, 'A', 'FIR_P', 'SAVF_X0', NULL, NULL, 'COMODORO RIVADAVIA FIR - X0', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, '2015-05-28 00:00:00', 'infinity');
update navdb.airspace set geom =
	ST_SetSRID(
		ST_Multi(
			ST_difference(
				(select geom from navdb.airspace where ident = 'SAVF' and typ = 'FIR'),
				(select geom from navdb.airspace where ident = 'CTRAGRA' and typ = 'CTR')
			)
		), 4326
	)
where ident = 'SAVF_X0' and typ = 'FIR_P';

-- SAVF_X1: Same as above, but with the inner geometry segmentized at 1000 meters
insert into navdb.airspace values((select max(airspace_pk) + 1 from navdb.airspace), '2015-05-28 00:00:00', '2015-10-27 16:28:41.194209', 'aixmimporter', 'aixmimporter', NULL, (select max(airspace_pk) + 1 from navdb.airspace), NULL, 'A', 'FIR_P', 'SAVF_X1', NULL, NULL, 'COMODORO RIVADAVIA FIR - X1', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, '2015-05-28 00:00:00', 'infinity');
update navdb.airspace set geom =
	ST_SetSRID(
		ST_Multi(
			ST_difference(
				(select geom from navdb.airspace where ident = 'SAVF' and typ = 'FIR'),
				(select ST_Segmentize (geom::geography, 1000)::geometry from navdb.airspace where ident = 'CTRAGRA' and typ = 'CTR')
			)
		), 4326
	)
where ident = 'SAVF_X1' and typ = 'FIR_P';

-- SAVF_X2: same as above, but with a narrow cut from the inner Falklands plygon to the outside border polygon
insert into navdb.airspace values((select max(airspace_pk) + 1 from navdb.airspace), '2015-05-28 00:00:00', '2015-10-27 16:28:41.194209', 'aixmimporter', 'aixmimporter', NULL, (select max(airspace_pk) + 1 from navdb.airspace), NULL, 'A', 'FIR_P', 'SAVF_X2', NULL, NULL, 'COMODORO RIVADAVIA FIR - X2', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, '2015-05-28 00:00:00', 'infinity');
update navdb.airspace set geom =
	ST_SetSRID(
		ST_Multi(
			ST_difference(
				(select geom from navdb.airspace where ident = 'SAVF_X1' and typ = 'FIR_P'),
				ST_SetSrid(
					ST_Buffer(
						ST_Segmentize (ST_SetSrid (ST_MakeLine(ST_MakePoint(-65.7266666666667, -55.3816666666667), ST_MakePoint(-61.920415857549806, -53.1411273099273)), 4326)::geography, 1000),
						0.01)::geometry,
					4326
				)
			)
		), 4326
	)
where ident = 'SAVF_X2' and typ = 'FIR_P';

